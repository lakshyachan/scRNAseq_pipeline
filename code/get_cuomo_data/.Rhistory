head(gencove_metadata)
library(data.table)
library(magrittr)
library(tidyr)
library(dplyr)
library(stringr)
ena.genotype <- fread("/Users/lakshmichanemougam/Desktop/Battle Lab/getting_fastq_files/filereport_analysis_PRJEB11750_tsv.txt") %>% print()
ena.zenodo.merged <- fread("/Users/lakshmichanemougam/Desktop/Battle Lab/getting_fastq_files/merge_ena_zenodo.csv") %>% print()
ena.genotype$donor_ids <- str_extract(ena.genotype$submitted_ftp, "(?<=\\/)[A-Za-z0-9_-]+(?=\\.)")
donor_ids <- as.array(ena.genotype$donor_ids)
donor_long_id <- as.array(ena.zenodo.merged$donor_long_id)
head(donor_ids)
head(donor_long_id)
length(intersect(donor_ids, donor_long_id))
merged.final <- ena.zenodo.merged[ena.zenodo.merged$donor_long_id %in% donor_ids]
head(merged.final)
write.csv(merged.final, "merged_final.csv", quote = FALSE, row.names = FALSE)
length(unique(ena.zenodo.merged$donor_long_id))
length(unique(merged.final$donor_long_id))
total_donors <- as.array(merged.final$donor_long_id)
freq <- table(total_donors)
freq <- freq[order(freq)]
freq
eipl_1_ftp <- as.array(subset(merged.final, donor_long_id == "HPSI0114i-eipl_1")$fastq_ftp)
write.table(eipl_1_ftp, file = "eipl_1_fastq_ftp.txt", row.names = FALSE, col.names = FALSE, quote = FALSE)
alter_ftp <- readLines("eipl_1_fastq_ftp.txt")
alter_ftp <- gsub(";","\n", alter_ftp)
writeLines(alter_ftp, "eipl_1_fastq_ftp.txt")
keywords <- c("HPSI0115i-zihe_1","HPSI0114i-iisa_3","HPSI0614i-uilk_3","HPSI0414i-xojn_3","HPSI0914i-qehq_3","HPSI0114i-eipl_1","HPSI0514i-letw_1","HPSI0314i-sojd_3","HPSI0214i-poih_4","HPSI0114i-joxm_1")
gencove_metadata <- merged.final[merged.final$donor_long_id %in% keywords]
gencove_metadata <- select(gencove_metadata, donor_short_id, donor_long_id, fastq_ftp)
for (keyword in keywords) {
temp <- gencove_metadata[gencove_metadata$donor_long_id %in% keyword, ]
for (i in 1:nrow(temp)) {
file_name <- paste0(temp[i, "donor_short_id"], "_fastq_ftp.txt")
write.table(temp[i, "fastq_ftp", drop = FALSE], file = file_name, row.names = FALSE, col.names = FALSE, quote = FALSE, append = TRUE)
alter_ftp <- readLines(file_name)
alter_ftp <- gsub(";","\n", alter_ftp)
writeLines(alter_ftp, file_name)
}
}
for (keyword in keywords){
temp <- ena.genotype[ena.genotype$donor_ids %in% keyword, ]
for (i in 1:nrow(temp)) {
write.table(temp[i, "submitted_ftp", drop = FALSE], file = "all_genotypes_ftp.txt", row.names = FALSE, col.names = FALSE, quote = FALSE, append = TRUE)
alter_ftp <- readLines("all_genotypes_ftp.txt")
alter_ftp <- gsub(";","\n", alter_ftp)
writeLines(alter_ftp, "all_genotypes_ftp.txt")
}
}
head(gencove_metadata)
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
write.csv(gencove_metadata, "gencove_metadata.csv")
gencove_metadata <- read.csv("gencove_metadata.csv")
gencove_metadata_split <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
head(gencove_metadata_split)
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
write.csv(gencove_metadata, "gencove_metadata.csv")
gencove_metadata <- read.csv("gencove_metadata.csv")
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- select(gencove_metadata, -X)
head(gencove_metadata_split)
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
write.csv(gencove_metadata, "gencove_metadata.csv", row.names = NULL)
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
write.csv(gencove_metadata, "gencove_metadata.csv", row.names = NULL)
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
write.csv(gencove_metadata, "gencove_metadata.csv", row.names = FALSE)
gencove_metadata <- read.csv("gencove_metadata.csv")
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
head(gencove_metadata_split)
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
write.csv(gencove_metadata, "gencove_metadata.csv", quote = FALSE, row.names = FALSE)
gencove_metadata <- read.csv("gencove_metadata.csv")
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
head(gencove_metadata_split)
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
write.csv(gencove_metadata, "gencove_metadata.csv", quote = FALSE, row.names = FALSE)
gencove_metadata <- read.csv("gencove_metadata.csv", select = c("donor_long_id","fastq_ftp"))
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
#write.csv(gencove_metadata, "gencove_metadata.csv", quote = FALSE, row.names = FALSE)
#gencove_metadata <- read.csv("gencove_metadata.csv")
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- mutate(gencove_metadata, r_notation = "")
head(gencove_metadata)
gencove_metadata <- select(gencove_metadata, donor_long_id, fastq_ftp)
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata_split <- select(gencove_metadata, donor_long_id, r_notation, everything()) %>%
mutate(r_notation = "")
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- mutate(gencove_metadata, r_notation = "")
gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
head(gencove_metadata)
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- mutate(gencove_metadata, r_notation = "")
gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
head(gencove_metadata)
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
#gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- mutate(gencove_metadata, r_notation = "")
gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
#gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
#gencove_metadata <- mutate(gencove_metadata, r_notation = "")
#gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
#gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
gencove_metadata <- gencove_metadata %>% mutate(path = str_replace(path, "ftp.sra.ebi.ac.uk/vol1/fastq/ERR\\d{3}/\\d{3}/", "/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/zihe_1/"))
head(gencove_metadata)
#gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
#gencove_metadata <- mutate(gencove_metadata, r_notation = "")
#gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
#gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
gencove_metadata <- gencove_metadata %>% mutate(path = str_replace(path, "ftp.sra.ebi.ac.uk/vol1/fastq/ERR\\d{3}/\\d{3}/ERR\\d+/ERR\\d+_", "/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/zihe_1/"))
head(gencove_metadata)
#gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
#gencove_metadata <- mutate(gencove_metadata, r_notation = "")
#gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
#gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
gencove_metadata <- gencove_metadata %>% mutate(path = str_replace(path, "ftp.sra.ebi.ac.uk/vol1/fastq/ERR\\d{3}/\\d{3}/", "/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/zihe_1/"), path = str_replace(path, "ERR\\d+_", ""))
head(gencove_metadata)
#gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
#gencove_metadata <- mutate(gencove_metadata, r_notation = "")
#gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
#gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
gencove_metadata <- gencove_metadata %>% mutate(path = str_replace(path, "ftp.sra.ebi.ac.uk/vol1/fastq/ERR\\d{3}/\\d{3}/", "/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/zihe_1/")
head(gencove_metadata)
#gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
#gencove_metadata <- mutate(gencove_metadata, r_notation = "")
#gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
#gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
gencove_metadata <- gencove_metadata %>% mutate(path = str_replace(path, "ftp.sra.ebi.ac.uk/vol1/fastq/ERR\\d{3}/\\d{3}/", "/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/zihe_1/"))
head(gencove_metadata)
#gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
#gencove_metadata <- mutate(gencove_metadata, r_notation = "")
#gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
#gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
gencove_metadata <- gencove_metadata %>% mutate(path = str_replace(path, "ftp.sra.ebi.ac.uk/vol1/fastq/ERR\\d{3}/\\d{3}/", "/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/zihe_1/"))
head(gencove_metadata)
keywords <- c("HPSI0115i-zihe_1","HPSI0114i-iisa_3","HPSI0614i-uilk_3","HPSI0414i-xojn_3","HPSI0914i-qehq_3","HPSI0114i-eipl_1","HPSI0514i-letw_1","HPSI0314i-sojd_3","HPSI0214i-poih_4","HPSI0114i-joxm_1")
gencove_metadata <- merged.final[merged.final$donor_long_id %in% keywords]
gencove_metadata <- select(gencove_metadata, donor_short_id, donor_long_id, fastq_ftp)
for (keyword in keywords) {
temp <- gencove_metadata[gencove_metadata$donor_long_id %in% keyword, ]
for (i in 1:nrow(temp)) {
file_name <- paste0(temp[i, "donor_short_id"], "_fastq_ftp.txt")
write.table(temp[i, "fastq_ftp", drop = FALSE], file = file_name, row.names = FALSE, col.names = FALSE, quote = FALSE, append = TRUE)
alter_ftp <- readLines(file_name)
alter_ftp <- gsub(";","\n", alter_ftp)
writeLines(alter_ftp, file_name)
}
}
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- mutate(gencove_metadata, r_notation = "")
gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
head(gencove_metadata)
library(data.table)
library(magrittr)
library(tidyr)
library(dplyr)
library(stringr)
ena.genotype <- fread("/Users/lakshmichanemougam/Desktop/Battle Lab/getting_fastq_files/filereport_analysis_PRJEB11750_tsv.txt") %>% print()
ena.zenodo.merged <- fread("/Users/lakshmichanemougam/Desktop/Battle Lab/getting_fastq_files/merge_ena_zenodo.csv") %>% print()
ena.genotype$donor_ids <- str_extract(ena.genotype$submitted_ftp, "(?<=\\/)[A-Za-z0-9_-]+(?=\\.)")
donor_ids <- as.array(ena.genotype$donor_ids)
donor_long_id <- as.array(ena.zenodo.merged$donor_long_id)
head(donor_ids)
head(donor_long_id)
length(intersect(donor_ids, donor_long_id))
merged.final <- ena.zenodo.merged[ena.zenodo.merged$donor_long_id %in% donor_ids]
head(merged.final)
write.csv(merged.final, "merged_final.csv", quote = FALSE, row.names = FALSE)
length(unique(ena.zenodo.merged$donor_long_id))
length(unique(merged.final$donor_long_id))
total_donors <- as.array(merged.final$donor_long_id)
freq <- table(total_donors)
freq <- freq[order(freq)]
freq
eipl_1_ftp <- as.array(subset(merged.final, donor_long_id == "HPSI0114i-eipl_1")$fastq_ftp)
write.table(eipl_1_ftp, file = "eipl_1_fastq_ftp.txt", row.names = FALSE, col.names = FALSE, quote = FALSE)
alter_ftp <- readLines("eipl_1_fastq_ftp.txt")
alter_ftp <- gsub(";","\n", alter_ftp)
writeLines(alter_ftp, "eipl_1_fastq_ftp.txt")
keywords <- c("HPSI0115i-zihe_1","HPSI0114i-iisa_3","HPSI0614i-uilk_3","HPSI0414i-xojn_3","HPSI0914i-qehq_3","HPSI0114i-eipl_1","HPSI0514i-letw_1","HPSI0314i-sojd_3","HPSI0214i-poih_4","HPSI0114i-joxm_1")
gencove_metadata <- merged.final[merged.final$donor_long_id %in% keywords]
gencove_metadata <- select(gencove_metadata, donor_short_id, donor_long_id, fastq_ftp)
for (keyword in keywords) {
temp <- gencove_metadata[gencove_metadata$donor_long_id %in% keyword, ]
for (i in 1:nrow(temp)) {
file_name <- paste0(temp[i, "donor_short_id"], "_fastq_ftp.txt")
write.table(temp[i, "fastq_ftp", drop = FALSE], file = file_name, row.names = FALSE, col.names = FALSE, quote = FALSE, append = TRUE)
alter_ftp <- readLines(file_name)
alter_ftp <- gsub(";","\n", alter_ftp)
writeLines(alter_ftp, file_name)
}
}
for (keyword in keywords){
temp <- ena.genotype[ena.genotype$donor_ids %in% keyword, ]
for (i in 1:nrow(temp)) {
write.table(temp[i, "submitted_ftp", drop = FALSE], file = "all_genotypes_ftp.txt", row.names = FALSE, col.names = FALSE, quote = FALSE, append = TRUE)
alter_ftp <- readLines("all_genotypes_ftp.txt")
alter_ftp <- gsub(";","\n", alter_ftp)
writeLines(alter_ftp, "all_genotypes_ftp.txt")
}
}
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- mutate(gencove_metadata, r_notation = "")
gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-19, nchar(gencove_metadata$path))
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-18, nchar(gencove_metadata$path))
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-20, nchar(gencove_metadata$path))
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-20, nchar(gencove_metadata$path))
head(gencove_metadata)
keywords <- c("HPSI0115i-zihe_1","HPSI0114i-iisa_3","HPSI0614i-uilk_3","HPSI0414i-xojn_3","HPSI0914i-qehq_3","HPSI0114i-eipl_1","HPSI0514i-letw_1","HPSI0314i-sojd_3","HPSI0214i-poih_4","HPSI0114i-joxm_1")
gencove_metadata <- merged.final[merged.final$donor_long_id %in% keywords]
gencove_metadata <- select(gencove_metadata, donor_short_id, donor_long_id, fastq_ftp)
gencove_metadata <- separate_rows(gencove_metadata, fastq_ftp, sep = ";")
gencove_metadata <- mutate(gencove_metadata, r_notation = "")
gencove_metadata <- select(gencove_metadata, donor_long_id, r_notation, fastq_ftp)
gencove_metadata <- rename(gencove_metadata, client_id = donor_long_id, path = fastq_ftp)
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-20, nchar(gencove_metadata$path))
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-20, nchar(gencove_metadata$path))
gencove_metadata$path <- paste0("/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/zihe_1/", gencove_metadata$path)
gencove_metadata$r_notation <- ifelse(substr(gencove_metadata$path, nchar(gencove_metadata$path)-4, nchar(gencove_metadata$path)-4) == "1", "r1", "r2")
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-20, nchar(gencove_metadata$path))
gencove_metadata$path <- paste0("/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/zihe_1/", gencove_metadata$path)
gencove_metadata$r_notation <- ifelse(substr(gencove_metadata$path, nchar(gencove_metadata$path)-9, nchar(gencove_metadata$path)-9) == "1", "r1", "r2")
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-20, nchar(gencove_metadata$path))
gencove_metadata$path <- paste0("/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/raw_reads/", gencove_metadata$path)
gencove_metadata$r_notation <- ifelse(substr(gencove_metadata$path, nchar(gencove_metadata$path)-9, nchar(gencove_metadata$path)-9) == "1", "r1", "r2")
head(gencove_metadata)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-20, nchar(gencove_metadata$path))
gencove_metadata$path <- paste0("/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/raw_reads/", gencove_metadata$path)
gencove_metadata$r_notation <- ifelse(substr(gencove_metadata$path, nchar(gencove_metadata$path)-9, nchar(gencove_metadata$path)-9) == "1", "r1", "r2")
head(gencove_metadata)
write.csv(gencove_metadata, "gencove_metadata.fastq-map.csv", quote = FALSE, row.names = FALSE)
gencove_metadata$path <- substring(gencove_metadata$path, nchar(gencove_metadata$path)-20, nchar(gencove_metadata$path))
gencove_metadata$path <- paste0("/home/lchanem1/scratch16-abattle4/lakshmi/cuomo_2020/raw_reads/", gencove_metadata$path)
gencove_metadata$r_notation <- ifelse(substr(gencove_metadata$path, nchar(gencove_metadata$path)-9, nchar(gencove_metadata$path)-9) == "1", "r1", "r2")
gencove_metadata$client_id <- gsub("_","-", gencove_metadata$client_id)
head(gencove_metadata)
write.csv(gencove_metadata, "gencove_metadata.fastq-map.csv", quote = FALSE, row.names = FALSE)
example <- read.csv("/Users/lakshmichanemougam/Downloads/gencove_metadata_zihe_1.fastq-map.csv")
library(data.table)
library(magrittr)
library(tidyr)
library(dplyr)
ena.runs.sc <- fread("/Users/lakshmichanemougam/Battle Lab/filereport_read_run_PRJEB14362_tsv.txt") %>% print()
zenodo.meta <- fread("/Users/lakshmichanemougam/Desktop/Battle Lab/cuomo_supplementary/cell_metadata_cols.tsv") %>% print()
#Make sure these are the same
stopifnot(all(zenodo.meta$V1 == zenodo.meta$cell_name))
ena.runs.sc <- ena.runs.sc %>% mutate("cell_name"=ena.runs.sc$submitted_ftp %>% basename(.) %>% gsub(pattern = ".cram", replacement = "", x = .))
length(unique(ena.runs.sc$cell_name))
length(unique(zenodo.meta$cell_name))
